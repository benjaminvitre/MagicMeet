<!DOCTYPE html>
<html lang="fr">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Profil â€” Magic Meet!</title>
Â  <link rel="stylesheet" href="style.css" />
Â  <style>
Â  Â  /* style spÃ©cifique pour la liste admin */
Â  Â  #admin-users-list { list-style: none; padding: 0; }
Â  Â  #admin-users-list li { background: #1a1f23; padding: 8px 10px; border-radius: 6px; margin-bottom: 5px; font-size: 0.9rem; }
Â  </style>
</head>
<body>
Â  <header class="header">
Â  Â  <a class="logo-link" href="index.html" aria-label="Accueil">
Â  Â  Â  Â  Â  Â  <svg width="56" height="56" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
Â  Â  Â  Â  <rect rx="18" ry="18" width="120" height="120" fill="#0f1417"/>
Â  Â  Â  Â  <circle cx="20" cy="18" r="6" fill="#b294f2"/>
Â  Â  Â  Â  <circle cx="40" cy="10" r="3" fill="#f6d06f"/>
Â  Â  Â  Â  <circle cx="60" cy="16" r="8" fill="#f5b88b"/>
Â  Â  Â  Â  <circle cx="88" cy="20" r="5" fill="#9fe3cc"/>
Â  Â  Â  Â  <circle cx="18" cy="92" r="6" fill="#f5b0d0"/>
Â  Â  Â  Â  <circle cx="36" cy="100" r="3" fill="#c085f5"/>
Â  Â  Â  Â  <circle cx="60" cy="98" r="10" fill="#6fb2f2"/>
Â  Â  Â  Â  <circle cx="92" cy="94" r="4" fill="#f6d06f"/>
Â  Â  Â  Â  <circle cx="100" cy="40" r="5" fill="#f5b88b"/>
Â  Â  Â  Â  <circle cx="98" cy="70" r="3" fill="#78d6a4"/>
Â  Â  Â  Â  <circle cx="30" cy="30" r="4" fill="#f1a66a"/>
Â  Â  Â  Â  <circle cx="80" cy="60" r="6" fill="#b294f2"/>
Â  Â  Â  Â  <g transform="translate(12,18)">
Â  Â  Â  Â  Â  <text x="0" y="58" font-family="Inter,Arial" font-weight="800" font-size="72" fill="#4da6ff">M</text>
Â  Â  Â  Â  Â  <text x="46" y="58" font-family="Inter,Arial" font-weight="800" font-size="72" fill="#48d28a">M</text>
Â  Â  Â  Â  </g>
Â  Â  Â  </svg>
Â  Â  </a>

Â  Â  <h1 class="site-title">Mon profil</h1>

Â  Â  <nav class="header-right">
Â  Â  Â  <a class="home-link" href="index.html">ğŸ  Accueil</a>
Â  Â  Â  <button id="logout" class="ghost-btn">Se dÃ©connecter</button>
Â  Â  </nav>
Â  </header>

Â  <main>
Â  Â  Â  Â  <section class="card" id="edit-slot-container" style="display:none;">
Â  Â  Â  <h2>Modifier le crÃ©neau</h2>
Â  Â  Â  <form id="edit-slot-form" onsubmit="return false;">
Â  Â  Â  Â  <input type="hidden" id="edit-slot-id" />

Â  Â  Â  Â  <label for="edit-activity-select">ActivitÃ©</label>
Â  Â  Â  Â  <select id="edit-activity-select"></select>

Â  Â  Â  Â  <label for="edit-sub-select">Sous-activitÃ©</label>
Â  Â  Â  Â  <select id="edit-sub-select"></select>

Â  Â  Â  Â  <label for="edit-subsub-select">Sous-sous-activitÃ© (optionnel)</label>
Â  Â  Â  Â  <select id="edit-subsub-select"></select>

Â  Â  Â  Â  <input id="edit-slot-name" type="text" placeholder="Nom du crÃ©neau" required />
Â  Â  Â  Â  <input id="edit-slot-location" type="text" placeholder="Lieu" required />
Â  Â  Â  Â  <div class="two-cols">
Â  Â  Â  Â  Â  <input id="edit-slot-date" type="date" required />
Â  Â  Â  Â  Â  <input id="edit-slot-time" type="time" required />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <label class="inline-label"><input id="edit-private-slot" type="checkbox" /> PrivÃ©</label>

Â  Â  Â  Â  <div class="row-btns">
Â  Â  Â  Â  Â  <button id="save-slot-changes">Sauvegarder les modifications</button>
Â  Â  Â  Â  Â  <button id="cancel-slot-edit" type="button" class="ghost-btn">Annuler</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </section>
Â  Â  Â  Â  
Â  Â  <section class="card">
Â  Â  Â  <h2>Mes informations</h2>
Â  Â  Â  <label>Pseudo</label>
Â  Â  Â  <input id="edit-pseudo" type="text" placeholder="Pseudo" />
Â  Â  Â  <label>Email</label>
Â  Â  Â  <input id="edit-email" type="email" placeholder="Email" readonly disabled />
Â  Â  Â  <label>TÃ©lÃ©phone</label>
Â  Â  Â  <input id="edit-phone" type="tel" placeholder="NumÃ©ro" />
Â  Â  Â  <div class="row-btns">
Â  Â  Â  Â  <button id="save-profile">Sauvegarder</button>
Â  Â  Â  Â  <a class="ghost-btn" href="index.html">Retour</a>
Â  Â  Â  </div>
Â  Â  </section>
Â  Â  
Â  Â  Â  Â  <section class="card">
Â  Â  Â  <h2>Danger Zone</h2>
Â  Â  Â  <button id="delete-account" style="background:#e74c3c; color:#fff;">Supprimer mon compte</button>
Â  Â  </section>

Â  Â  <section class="card">
Â  Â  Â  <h2>Mes crÃ©neaux</h2>
Â  Â  Â  <ul id="user-slots"></ul>
Â  Â  </section>
Â  Â  
Â  Â  Â  Â  <section class="card" id="admin-users" style="display:none;">
Â  Â  Â  <h2>ğŸ‘¥ Utilisateurs enregistrÃ©s (Admin)</h2>
Â  Â  Â  <ul id="admin-users-list"></ul>
Â  Â  </section>

Â  Â  <section class="card" id="admin-tools" style="display:none;">
Â  Â  Â  <h2>ğŸ“¦ Sauvegarde / Restauration (Admin)</h2>
Â  Â  Â  <button id="export-data">Exporter les donnÃ©es (JSON)</button>
Â  Â  Â  <input id="import-data" type="file" accept=".json" />
Â  Â  </section>
Â  </main>

Â  <script src="script.js"></script>
Â  <script>
Â  Â  // profile-specific code (uses functions defined in script.js)
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
Â  Â  Â  if (!currentUser) { alert('Connecte-toi dâ€™abord'); window.location.href = 'index.html'; return; }
      
Â  Â  Â  // --- Logique d'Ã©dition de crÃ©neau (ajout) ---
Â  Â  Â  const editContainer = document.getElementById('edit-slot-container');
Â  Â  Â  const editActSelect = document.getElementById('edit-activity-select');
Â  Â  Â  const editSubSelect = document.getElementById('edit-sub-select');

Â  Â  Â  // Mettre Ã  jour les sous-activitÃ©s quand l'activitÃ© principale change dans le formulaire d'Ã©dition
Â  Â  Â  if (editActSelect && typeof populateEditSubActivities === 'function') {
Â  Â  Â  Â  editActSelect.addEventListener('change', () => {
Â  Â  Â  Â  Â  populateEditSubActivities(editActSelect.value);
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Mettre Ã  jour les sous-sous-activitÃ©s quand la sous-activitÃ© change
Â  Â  Â  if (editSubSelect && typeof populateEditSubSub === 'function') {
Â  Â  Â  Â  editSubSelect.addEventListener('change', () => {
Â  Â  Â  Â  Â  populateEditSubSub(editSubSelect.value);
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  // Gestion de la sauvegarde des modifications
Â  Â  Â  document.getElementById('save-slot-changes')?.addEventListener('click', () => {
Â  Â  Â  Â  const slotId = parseInt(document.getElementById('edit-slot-id').value);
Â  Â  Â  Â  const newName = document.getElementById('edit-slot-name').value.trim();
Â  Â  Â  Â  const newLocation = document.getElementById('edit-slot-location').value.trim();
Â  Â  Â  Â  const newDate = document.getElementById('edit-slot-date').value.trim();
Â  Â  Â  Â  const newTime = document.getElementById('edit-slot-time').value.trim();
Â  Â  Â  Â  const newPrivate = document.getElementById('edit-private-slot').checked;
Â  Â  Â  Â  const newActivity = editActSelect.value;
Â  Â  Â  Â  const newSub = editSubSelect.value;
Â  Â  Â  Â  const newSubSub = document.getElementById('edit-subsub-select').value;
Â  Â  Â  Â  
Â  Â  Â  Â  if (!newName || !newLocation || !newDate || !newTime || !newActivity) {
Â  Â  Â  Â  Â  return alert("Veuillez remplir tous les champs obligatoires (Nom, Lieu, Date, Heure, ActivitÃ©).");
Â  Â  Â  Â  }

Â  Â  Â  Â  if (typeof updateSlot === 'function') {
Â  Â  Â  Â  Â  updateSlot(slotId, slot => ({
Â  Â  Â  Â  Â  Â  ...slot,
Â  Â  Â  Â  Â  Â  name: newName,
Â  Â  Â  Â  Â  Â  location: newLocation,
Â  Â  Â  Â  Â  Â  date: newDate,
Â  Â  Â  Â  Â  Â  time: newTime,
Â  Â  Â  Â  Â  Â  private: newPrivate,
Â  Â  Â  Â  Â  Â  activity: newActivity,
Â  Â  Â  Â  Â  Â  sub: newSub,
Â  Â  Â  Â  Â  Â  subsub: newSubSub
Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  alert("CrÃ©neau mis Ã  jour !");
Â  Â  Â  Â  Â  editContainer.style.display = 'none'; // Cacher le formulaire
Â  Â  Â  Â  Â  loadUserSlots(); // Recharger les crÃ©neaux
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  // Gestion de l'annulation
Â  Â  Â  document.getElementById('cancel-slot-edit')?.addEventListener('click', () => {
Â  Â  Â  Â  editContainer.style.display = 'none';
Â  Â  Â  });
Â  Â  Â  // --- Fin Logique d'Ã©dition de crÃ©neau ---


Â  Â  Â  const userEmailField = document.getElementById('edit-email');
Â  Â  Â  document.getElementById('edit-pseudo').value = currentUser.pseudo || '';
Â  Â  Â  userEmailField.value = currentUser.email || '';
Â  Â  Â  document.getElementById('edit-phone').value = currentUser.phone || '';

Â  Â  Â  // Sauvegarde du profil... (le code est dÃ©jÃ  prÃ©sent)
Â  Â  Â  
Â  Â  Â  // Suppression de compte... (le code est dÃ©jÃ  prÃ©sent)

Â  Â  Â  // Fonction pour peupler les crÃ©neaux de l'utilisateur
Â  Â  Â  function loadUserSlots(){
Â  Â  Â  Â  const all = (typeof getSlots === 'function') ? getSlots() : [];
Â  Â  Â  Â  const mine = all.filter(s => s.owner === currentUser.email);
Â  Â  Â  Â  const ul = document.getElementById('user-slots');
Â  Â  Â  Â  ul.innerHTML = '';
Â  Â  Â  Â  
Â  Â  Â  Â  if (!mine.length) ul.innerHTML = '<p>Aucun crÃ©neau crÃ©Ã©.</p>';
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  mine.forEach(s => {
Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  li.className = 'slot-item';
Â  Â  Â  Â  Â  Â  const formattedDate = (typeof formatDateToWords === 'function') ? formatDateToWords(s.date) : s.date;
Â  Â  Â  Â  Â  Â  const participantsCount = (s.participants || []).length;

Â  Â  Â  Â  Â  Â  li.innerHTML = `<div class="slot-info">
Â  Â  Â  Â  Â  Â  Â  <strong>${s.name} ${s.private ? 'ğŸ”’' : ''}</strong>
Â  Â  Â  Â  Â  Â  Â  <div>${s.subsub || s.sub} â€” ğŸ“ ${s.location}</div>
Â  Â  Â  Â  Â  Â  Â  <small>ğŸ—“ï¸ ${formattedDate} ${s.time} - ğŸ‘¤ ${participantsCount} participants</small>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const actions = document.createElement('div'); actions.className='actions';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Bouton Modifier (ajout)
Â  Â  Â  Â  Â  Â  const editBtn = document.createElement('button'); editBtn.textContent = 'âœï¸'; editBtn.title = 'Modifier';
Â  Â  Â  Â  Â  Â  editBtn.onclick = () => { if (typeof editSlot === 'function') editSlot(s.id); };
Â  Â  Â  Â  Â  Â  actions.appendChild(editBtn);

Â  Â  Â  Â  Â  Â  // Bouton Supprimer
Â  Â  Â  Â  Â  Â  const del = document.createElement('button'); del.textContent='ğŸ—‘ï¸'; del.title='Supprimer';
Â  Â  Â  Â  Â  Â  del.onclick = () => { 
Â  Â  Â  Â  Â  Â  Â  if (!confirm('Supprimer ?')) return; 
Â  Â  Â  Â  Â  Â  Â  const updated = (typeof getSlots === 'function') ? getSlots().filter(x=>x.id!==s.id) : []; 
Â  Â  Â  Â  Â  Â  Â  if (typeof saveSlots === 'function') saveSlots(updated); 
Â  Â  Â  Â  Â  Â  Â  loadUserSlots(); // Recharger la liste
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  actions.appendChild(del);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  li.appendChild(actions);
Â  Â  Â  Â  Â  Â  ul.appendChild(li);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  loadUserSlots(); // Appel initial

Â  Â  Â  // show admin tools & admin users list (le code est dÃ©jÃ  prÃ©sent)
Â  Â  Â  
Â  Â  Â  // admin export/import (le code est dÃ©jÃ  prÃ©sent)
Â  Â  });
Â  </script>
</body>
</html>
